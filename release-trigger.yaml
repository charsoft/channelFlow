build:
  steps:
  - name: 'ubuntu'
    id: 'Debug Pub/Sub Message'
    entrypoint: 'bash'
    args:
    - "-c"
    - |
      echo "--- DECODED PUB/SUB MESSAGE ---"
      echo "${_MESSAGE}" | base64 -d | jq .
      echo "--- END DECODED MESSAGE ---"
      echo "Build intentionally failed for debugging. Please check logs for message structure."
      exit 1
  substitutions:
    _MESSAGE: $(body.message.data)
  timeout: 600s
description: Triggers on any new build pushed to Artifact Registry. Creates a new
  release in Cloud Deploy.
name: channel-flow-new-release
pubsubConfig:
  subscription: projects/channel-flow-2/subscriptions/gcb-channel-flow-new-release
  topic: projects/channel-flow-2/topics/gcr
serviceAccount: projects/channel-flow-2/serviceAccounts/channel-flow-svc-builder@channel-flow-2.iam.gserviceaccount.com
filename: release-trigger.yaml 